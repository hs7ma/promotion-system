# PromoTrack Database Setup Guide - ุฏููู ุฅุนุฏุงุฏ ูุงุนุฏุฉ ุงูุจูุงูุงุช

## ๐ ูุธุฑุฉ ุนุงูุฉ

ูุฐุง ุงูุฏููู ููุถุญ ููููุฉ ุฅุนุฏุงุฏ ูุงุนุฏุฉ ุจูุงูุงุช Supabase ููุธุงู PromoTrack ูุชุชุจุน ุชุฑููุงุช ุฃุนุถุงุก ููุฆุฉ ุงูุชุฏุฑูุณ.

## ๐๏ธ ุงููููุงุช

| ุงูููู | ุงููุตู |
|-------|-------|
| `supabase_schema.sql` | ุงููุฎุทุท ุงูุฑุฆูุณู ููุงุนุฏุฉ ุงูุจูุงูุงุช (ูุน ูุตุงุฏูุฉ Supabase) |
| `supabase_public_access.sql` | ุณูุงุณุงุช ุงููุตูู ุงูุนุงู (ููุชุทููุฑ ูุงูุงุฎุชุจุงุฑ ุจุฏูู ูุตุงุฏูุฉ) |

## ๐ ุฎุทูุงุช ุงูุฅุนุฏุงุฏ

### ุงูุฎุทูุฉ 1: ุฅูุดุงุก ูุดุฑูุน Supabase

1. ุงุฐูุจ ุฅูู [supabase.com](https://supabase.com)
2. ุฃูุดุฆ ุญุณุงุจ ุฌุฏูุฏ ุฃู ุณุฌู ุฏุฎูู
3. ุงุถุบุท ุนูู "New Project"
4. ุงุฎุชุฑ ุงุณู ูููุดุฑูุน ููููุฉ ูุฑูุฑ ูููุฉ ูููุงุนุฏุฉ
5. ุงุฎุชุฑ ุงูููุทูุฉ ุงูุฃูุฑุจ ูู

### ุงูุฎุทูุฉ 2: ุชุดุบูู ุงููุฎุทุท ุงูุฑุฆูุณู

1. ูู ููุญุฉ ุชุญูู Supabaseุ ุงุฐูุจ ุฅูู **SQL Editor**
2. ุงุถุบุท ุนูู **New Query**
3. ุงูุณุฎ ูุงูุตู ูุญุชูู ููู `supabase_schema.sql`
4. ุงุถุบุท ุนูู **Run** ูุชูููุฐ ุงูููุฏ

### ุงูุฎุทูุฉ 3: ููุชุทููุฑ/ุงูุงุฎุชุจุงุฑ (ุงุฎุชูุงุฑู)

ุฅุฐุง ููุช ุชุฑูุฏ ุงุณุชุฎุฏุงู ุงูุชุทุจูู ุจุฏูู ูุธุงู ูุตุงุฏูุฉ (ููุชุทููุฑ):

1. ุจุนุฏ ุชูููุฐ ุงููุฎุทุท ุงูุฑุฆูุณู
2. ุงูุณุฎ ูุงูุตู ูุญุชูู ููู `supabase_public_access.sql`
3. ุงุถุบุท ุนูู **Run**

### ุงูุฎุทูุฉ 4: ุงูุญุตูู ุนูู ููุงุชูุญ API

1. ุงุฐูุจ ุฅูู **Settings** > **API**
2. ุงุญูุธ:
   - **Project URL**: `https://xxxxx.supabase.co`
   - **anon/public key**: ุงูููุชุงุญ ุงูุนุงู
   - **service_role key**: ููุชุงุญ ุงูุฎุฏูุฉ (ููุฎุงุฏู ููุท)

## ๐ ูููู ูุงุนุฏุฉ ุงูุจูุงูุงุช

### ุงูุฌุฏุงูู ุงูุฑุฆูุณูุฉ

```
โโโโโโโโโโโโโโโโโโโโโโโ
โ  faculty_profiles   โ โ ูุนูููุงุช ุนุถู ููุฆุฉ ุงูุชุฏุฑูุณ
โโโโโโโโโโโโโโโโโโโโโโโค
โ id (UUID, PK)       โ
โ user_id (UUID, FK)  โ
โ name               โ
โ degree             โ
โ current_position   โ
โ total_points       โ
โ is_eligible        โ
โ wizard_completed   โ
โโโโโโโโโโโโโโโโโโโโโโโ
         โ
         โ 1:N
         โผ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                    ุงูุฅูุฌุงุฒุงุช                            โ
โโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโฌโโโโโโโโโโโโโโโโโโโโโโโโค
โ research_papersโ patents        โ supervisions          โ
โ conferences    โ training_coursesโ teaching_activities  โ
โโโโโโโโโโโโโโโโโโดโโโโโโโโโโโโโโโโโดโโโโโโโโโโโโโโโโโโโโโโโโ
```

### ุฌุฏุงูู ุงูุชูููู

```
points_config        โ ููุงุท ูู ูุดุงุท
promotion_requirements โ ูุชุทูุจุงุช ุงูุชุฑููุฉ ููู ูุณุชูู
```

## ๐ ูุธุงู ุงูููุงุท

### ุงูุฃุจุญุงุซ (Research)
| ุงูุชุตููู | ุงูููุงุท |
|---------|--------|
| Q1 | 15 |
| Q2 | 12 |
| Q3 | 10 |
| Q4 | 5 |
| Local | 3 |

### ุจุฑุงุกุงุช ุงูุงุฎุชุฑุงุน (Patents)
| ุงูุญุงูุฉ | ุงูููุงุท |
|--------|--------|
| Granted | 20 |
| Pending | 10 |

### ุงูุฅุดุฑุงู (Supervision)
| ุงูููุน | ุงูููุงุท |
|-------|--------|
| Ph.D. | 15 |
| Master's | 10 |
| Graduation | 5 |

### ุงููุคุชูุฑุงุช (Conferences)
| ุงูููุน | ุงูููุงุท |
|-------|--------|
| International Presenter | 8 |
| International Attendee | 4 |
| Local Presenter | 5 |
| Local Attendee | 2 |

### ุงูุชุฏุฑูุจ (Training)
| ุงูููุน | ุงูููุงุท |
|-------|--------|
| Certified | 5 |
| Uncertified | 2 |

### ุงูุชุฏุฑูุณ (Teaching)
| ุงูููุน | ุงูููุงุท |
|-------|--------|
| Course Development | 8 |
| Lectures | 3 |
| Assessment | 2 |

## ๐ง ุงูุฏูุงู ุงููุชุงุญุฉ (RPC Functions)

### ููุงุณุชุฎุฏุงู ุงูุนุงู (ูุน ูุตุงุฏูุฉ)

```javascript
// ุงูุญุตูู ุนูู ุจูุงูุงุช ุนุถู ููุฆุฉ ุงูุชุฏุฑูุณ
const { data } = await supabase.rpc('get_faculty_data', { p_faculty_id: 'uuid' });

// ุญุณุงุจ ุงูููุงุท
const { data } = await supabase.rpc('calculate_faculty_points', { p_faculty_id: 'uuid' });

// ูุญุต ุงูุฃูููุฉ ููุชุฑููุฉ
const { data } = await supabase.rpc('check_promotion_eligibility', { p_faculty_id: 'uuid' });

// ูุญุงูุงุฉ ุงูููุงุท
const { data } = await supabase.rpc('simulate_points', { 
    p_faculty_id: 'uuid',
    p_additions: { research: [{ quartile: 'Q1' }] }
});
```

### ูููุตูู ุงูุนุงู (ุจุฏูู ูุตุงุฏูุฉ)

```javascript
// ุงูุญุตูู ุนูู ุงูุจูุงูุงุช ุงูุงูุชุฑุงุถูุฉ
const { data } = await supabase.rpc('get_default_faculty_data');

// ุฅููุงู ุงููุนุงูุฌ
const { data } = await supabase.rpc('complete_wizard_public', {
    p_name: 'Dr. Ahmed',
    p_degree: 'phd',
    p_position: 'teaching_assistant',
    p_achievements: {
        research: [{ title: 'Paper 1', quartile: 'Q1' }]
    }
});

// ุฅุถุงูุฉ ุฅูุฌุงุฒ
const { data } = await supabase.rpc('add_achievement_public', {
    p_type: 'research',
    p_data: { title: 'New Paper', quartile: 'Q2' }
});

// ุญุฐู ุฅูุฌุงุฒ
const { data } = await supabase.rpc('delete_achievement_public', {
    p_type: 'research',
    p_id: 123
});

// ุฅุนุงุฏุฉ ุชุนููู ุงูุจูุงูุงุช
const { data } = await supabase.rpc('reset_default_faculty');

// ุชูุฏูู ุทูุจ ุชุฑููุฉ
const { data } = await supabase.rpc('submit_promotion_public');
```

## ๐ ุฃูุงู ุงูุจูุงูุงุช

### Row Level Security (RLS)

ุฌููุน ุงูุฌุฏุงูู ูููุนูู ูููุง RLS:
- ุงููุณุชุฎุฏู ููููู ููุท ุฑุคูุฉ ูุชุนุฏูู ุจูุงูุงุชู ุงูุฎุงุตุฉ
- ุณูุงุณุงุช ูููุตูุฉ ูููุฑุงุกุฉุ ุงูุฅุฏุฑุงุฌุ ุงูุชุญุฏูุซุ ูุงูุญุฐู

### ููุชุทููุฑ

ููู `supabase_public_access.sql` ููุนุทูู ุณูุงุณุงุช ุงููุตุงุฏูุฉ ููุณูุญ ุจุงููุตูู ุงูุนุงู. 

โ๏ธ **ูุง ุชุณุชุฎุฏู ูุฐุง ูู ุงูุฅูุชุงุฌ!**

## ๐ ุงูุชุญุฏูุซุงุช ุงูุชููุงุฆูุฉ

ูุงุนุฏุฉ ุงูุจูุงูุงุช ุชุญุชูู ุนูู Triggers ุชููู ุชููุงุฆูุงู ุจู:
- ุญุณุงุจ ุงูููุงุท ุนูุฏ ุฅุถุงูุฉ/ุชุนุฏูู/ุญุฐู ุฃู ุฅูุฌุงุฒ
- ุชุญุฏูุซ ุญุงูุฉ ุงูุฃูููุฉ ููุชุฑููุฉ
- ุชุญุฏูุซ ุฅุฌูุงูู ุงูููุงุท ูู ููู ุงููุณุชุฎุฏู

## ๐ ููุงุญุธุงุช ูุงูุฉ

1. **ุงูููุงุท ุชูุญุณุจ ุชููุงุฆูุงู**: ูุง ุชุญุชุงุฌ ูุฅุฑุณุงู ูููุฉ ุงูููุงุท ุนูุฏ ุฅุถุงูุฉ ุฅูุฌุงุฒ
2. **ุงูุฃูููุฉ ุชูุญุฏูุซ ุชููุงุฆูุงู**: ุนูุฏ ุชุบููุฑ ุงูููุงุท
3. **UUID**: ุงุณุชุฎุฏู `uuid_generate_v4()` ูููุนุฑูุงุช ุงูุฌุฏูุฏุฉ
4. **ุงูุชูููุช**: ุฌููุน ุงูุฃููุงุช ุจุชูุณูู UTC ูุน timezone

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุฎุทุฃ: "permission denied"
- ุชุฃูุฏ ูู ุชูููุฐ ุณูุงุณุงุช ุงููุตูู ุงูุนุงู ุฅุฐุง ููุช ูุง ุชุณุชุฎุฏู ุงููุตุงุฏูุฉ

### ุฎุทุฃ: "violates foreign key constraint"
- ุชุฃูุฏ ูู ูุฌูุฏ ููู ุงููุณุชุฎุฏู ูุจู ุฅุถุงูุฉ ุงูุฅูุฌุงุฒุงุช

### ุฎุทุฃ: "invalid input value for enum"
- ุชุญูู ูู ุงูููู ุงููุณููุญุฉ ูู ENUM (ูุซู: 'Q1', 'Q2', 'Q3', 'Q4', 'local')

## ๐ ุงูุฏุนู

ุฅุฐุง ูุงุฌูุช ุฃู ูุดุงููุ ุชุญูู ูู:
1. ูุญุฏุฉ ุชุญูู Supabase ููุฃุฎุทุงุก
2. ุณุฌูุงุช ุงูุฎุงุฏู
3. Network tab ูู ูุชุตูุญู


